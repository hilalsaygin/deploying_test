'use strict';const mongoose=require("mongoose"),slugify=require("slugify"),validator=require("validator"),reqString={type:String,null:!0},reqNumber={type:Number,null:!0},reqArray={type:Array,null:!0},topMediaSchema=new mongoose.Schema({id:reqString,caption:reqString,permalink:reqString,like_count:reqNumber,comments_count:reqNumber}),tourSchema=new mongoose.Schema({id:reqString,username:reqString,website:reqString,name:reqString,biography:reqString,followers_count:reqNumber,follows_count:reqNumber,
media_count:reqNumber,profile_picture_url:reqString,category:reqArray,IGI:reqNumber,top_media:[topMediaSchema]});tourSchema.pre("save",function(a){this.slug=slugify(this.name,{lower:!0});a()});tourSchema.pre(/^find/,function(a){this.find({secretTour:{$ne:!0}});this.start=Date.now();a()});tourSchema.post(/^find/,function(a,b){console.log(`Query took ${Date.now()-this.start} milliseconds!`);b()});
tourSchema.pre("aggregate",function(a){this.pipeline().unshift({$match:{secretTour:{$ne:!0}}});console.log(this.pipeline());a()});const Tour=mongoose.model("Tour",tourSchema);module.exports=Tour;